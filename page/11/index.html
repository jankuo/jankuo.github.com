<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="lie,个人博客,技术,产品" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="lie的个人博客,记录了一些生活琐事和一些程序，一些想法">
<meta property="og:type" content="website">
<meta property="og:title" content="lie的个人博客">
<meta property="og:url" content="http://i.joymvp.com/page/11/index.html">
<meta property="og:site_name" content="lie的个人博客">
<meta property="og:description" content="lie的个人博客,记录了一些生活琐事和一些程序，一些想法">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="lie的个人博客">
<meta name="twitter:description" content="lie的个人博客,记录了一些生活琐事和一些程序，一些想法">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://i.joymvp.com/page/11/"/>





  <title>lie的个人博客</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">lie的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">匆匆行走，总要留下什么</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://i.joymvp.com/[object Object]/2014-01-01-ssdb-startup.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lie的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]/2014-01-01-ssdb-startup.html" itemprop="url">ssdb startup</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T12:16:35+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]/2014-01-01-ssdb-startup.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/[object Object]/2014-01-01-ssdb-startup.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>SSDB 是一个持久化的 KV NoSQL 存储服务器, 以 LevelDB 作为存储引擎, 支持 PHP/Java/Python/C/C++ 等客户端.</code></p>
<p>关于<strong>ssdb</strong> 以上应该解释的很清楚了。今天试用了一下，安装如下：</p>
<pre><code>$ wget --no-check-certificate https://github.com/ideawu/ssdb/archive/master.zip
$ unzip master
$ cd ssdb-master
$ make
$ #optional, install ssdb in /usr/local/ssdb
$ sudo make install
</code></pre><p>##安装过程来说没什么，但是使用过程有点坑了：</p>
<pre><code># start master
$ ./ssdb-server ssdb.conf

# or start as daemon
$ ./ssdb-server -d ssdb.conf

# start slave
$ ./ssdb-server ssdb_slave.conf

# ssdb command line
$ ./tools/ssdb-cli -p 8888

# stop ssdb-server
$ kill `cat ./var/ssdb.pid`
</code></pre><p>##应该说使用过程中的坑是安转的时候没设置好才对的</p>
<ol>
<li><p>必须到 <code>/usr/local/ssdb/</code> 目录下才能执行 <code>ssdb-server ssdb.conf</code>  其它命令类似</p>
</li>
<li><p>如果执行 <code>ssdb-server</code> 时没给出 <code>ssdb.conf</code> 则会报错</p>
</li>
<li><p><code>ssdb-ins.sh</code> 应该是一个开机启动脚本，但抱歉…这个没有 <code>ssdb.conf</code>是会报错的</p>
</li>
</ol>
<p>最后，赞一下这个 <code>ssdb</code></p>
<p>##关于项目：</p>
<ol>
<li><p><a href="https://github.com/ideawu/ssdb" target="_blank" rel="external">ssdb github</a> </p>
</li>
<li><p><a href="http://www.ideawu.net/blog/ssdb" target="_blank" rel="external">ssdb doc文档</a></p>
</li>
<li><p>官方微信：<strong>udpwork</strong></p>
</li>
<li><p>官方微博：<a href="http://weibo.com/ideawu" target="_blank" rel="external">http://weibo.com/ideawu</a></p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://i.joymvp.com/[object Object]/2014-05-01-about-lsof.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lie的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]/2014-05-01-about-lsof.html" itemprop="url">lsof一些用法</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T12:16:35+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]/2014-05-01-about-lsof.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/[object Object]/2014-05-01-about-lsof.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="lsof-帮助文档-lsof-help"><a href="#lsof-帮助文档-lsof-help" class="headerlink" title="lsof 帮助文档 lsof --help"></a>lsof 帮助文档 <code>lsof --help</code></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[-?abhlnNoOPRtUvV] [+|-c c] [+|-d s] [+D D] [+|-f[cgG]]</div><div class="line"> [-F [f]] [-g [s]] [-i [i]] [+|-L [l]] [+|-M] [-o [o]] [-p s]</div><div class="line">[+|-r [t]] [-s [p:s]] [-S [t]] [-T [t]] [-u s] [+|-w] [-x [fl]] [--] [names]</div><div class="line">Defaults in parentheses; comma-separated set (s) items; dash-separated ranges.</div><div class="line">  -?|-h list help          -a AND selections (OR)     -b avoid kernel blocks</div><div class="line">  -c c  cmd c ^c /c/[bix]  +c w  COMMAND width (9)    +d s  dir s files</div><div class="line">  -d s  select by FD set   +D D  dir D tree *SLOW?*   -i select IPv[46] files</div><div class="line">  -l list UID numbers      -n no host names           -N select NFS files</div><div class="line">  -o list file offset      -O no overhead *RISKY*     -P no port names</div><div class="line">  -R list paRent PID       -s list file size          -t terse listing</div><div class="line">  -T disable TCP/TPI info  -U select Unix socket      -v list version info</div><div class="line">  -V verbose search        +|-w  Warnings (+)         -- end option scan</div><div class="line">  +f|-f  +filesystem or -file names     +|-f[cgG] Ct flaGs</div><div class="line">  -F [f] select fields; -F? for help  </div><div class="line">  +|-L [l] list (+) suppress (-) link counts &lt; l (0 = all; default = 0)</div><div class="line">  +|-M   portMap registration (-)       -o o   o 0t offset digits (8)</div><div class="line">  -p s   exclude(^)|select PIDs         -S [t] t second stat timeout (15)</div><div class="line">  -T fqs TCP/TPI Fl,Q,St (s) info</div><div class="line">  -g [s] exclude(^)|select and print process group IDs</div><div class="line">  -i i   select by IPv[46] address: [46][proto][@host|addr][:svc_list|port_list]</div><div class="line">  +|-r [t[m&lt;fmt&gt;]] repeat every t seconds (15);  + until no files, - forever.</div><div class="line">       An optional suffix to t is m&lt;fmt&gt;; m must separate t from &lt;fmt&gt; and</div><div class="line">      &lt;fmt&gt; is an strftime(3) format for the marker line.</div><div class="line">  -s p:s  exclude(^)|select protocol (p = TCP|UDP) states by name(s).</div><div class="line">  -u s   exclude(^)|select login|UID set s</div><div class="line">  -x [fl] cross over +d|+D File systems or symbolic Links</div><div class="line">  names  select named files or files on named file systems</div><div class="line">Anyone can list all files; /dev warnings disabled; kernel ID check disabled.</div></pre></td></tr></table></figure>
<h2 id="列出所有打开的文件和网络lsof"><a href="#列出所有打开的文件和网络lsof" class="headerlink" title="列出所有打开的文件和网络lsof"></a>列出所有打开的文件和网络<code>lsof</code></h2><pre><code>&gt;lsof
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">COMMAND   PID       USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</div><div class="line">UserEvent 141      sense   20r   DIR    1,2      816 2120 /private/var</div><div class="line">UserEvent 141      sense   25r   DIR    1,2      816 2120 /private/var</div><div class="line">UserEvent 141      sense   48r   DIR    1,2      816 2120 /private/var</div></pre></td></tr></table></figure>
<h2 id="列出某个用户打开的文件-lsof-u-username"><a href="#列出某个用户打开的文件-lsof-u-username" class="headerlink" title="列出某个用户打开的文件 lsof -u [username]"></a>列出某个用户打开的文件 <code>lsof -u [username]</code></h2><pre><code>&gt;lsof -u sense
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">COMMAND   PID       USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</div><div class="line">lsof      19789     sense  cwd      DIR                1,2       3536 13227011 /Users/sense/Developer/github/blog/_posts</div><div class="line">lsof      19789     sense  txt      REG                1,2     109248    11809 /usr/sbin/lsof</div><div class="line">lsof      19789     sense  txt      REG                1,2     600832  4153010 /usr/lib/dyld</div><div class="line">lsof      19789     sense  txt      REG                1,2  343645146 12741449 /private/var/db/dyld/dyld_shared_cache_x86_64</div><div class="line">lsof      19789     sense    0u     CHR               16,0   0t447034      851 /dev/ttys000</div><div class="line">lsof      19789     sense    1u     CHR               16,0   0t447034      851 /dev/ttys000</div><div class="line">lsof      19789     sense    2u     CHR               16,0   0t447034      851 /dev/ttys000</div><div class="line">lsof      19789     sense    4     PIPE 0x6bbd73588ce7bfb7      16384          -&gt;0x6bbd735884f094e7</div><div class="line">lsof      19789     sense    5     PIPE 0x6bbd73588ce7d9d7      16384          -&gt;0x6bbd735884f0ab97</div></pre></td></tr></table></figure>
<h2 id="列出某个端口运行的进程-lsof-i-port-number"><a href="#列出某个端口运行的进程-lsof-i-port-number" class="headerlink" title="列出某个端口运行的进程 lsof -i :[port_number]"></a>列出某个端口运行的进程 <code>lsof -i :[port_number]</code></h2><pre><code>&gt;lsof -i :3306
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">COMMAND   PID       USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</div><div class="line">mysqld  20150     sense   14u  IPv6 0x6bbd735884c780f7      0t0  TCP *:mysql (LISTEN)</div></pre></td></tr></table></figure>
<h2 id="只列出ip4-ip6打开的文件-lsof-i-4-OR-lsof-i-6"><a href="#只列出ip4-ip6打开的文件-lsof-i-4-OR-lsof-i-6" class="headerlink" title="只列出ip4/ip6打开的文件 lsof -i 4 OR lsof -i 6"></a>只列出ip4/ip6打开的文件 <code>lsof -i 4</code> OR <code>lsof -i 6</code></h2><pre><code>&gt;lsof -i 4
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">COMMAND   PID       USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</div><div class="line">UserEvent 141       sense  6u   IPv4 0x6bbd735883aeec5f      0t0  UDP *:*</div><div class="line">SystemUIS 171       sense  5u   IPv4 0x6bbd735883aee88f      0t0  UDP *:*</div><div class="line">sharingd  180       sense  18u  IPv4 0x6bbd7358876c57cf      0t0  UDP *:*</div></pre></td></tr></table></figure>
<pre><code>&gt;lsof -i 6
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">COMMAND   PID       USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</div><div class="line">mysqld  20150     sense   14u  IPv6 0x6bbd735884c780f7      0t0  TCP *:mysql (LISTEN)</div></pre></td></tr></table></figure>
<h2 id="列出端口在1-3306-之间的所有进程-lsof-i-1-3306"><a href="#列出端口在1-3306-之间的所有进程-lsof-i-1-3306" class="headerlink" title="列出端口在1-3306 之间的所有进程 lsof -i :1-3306"></a>列出端口在1-3306 之间的所有进程 <code>lsof -i :1-3306</code></h2><pre><code>&gt; lsof -i :1-3306
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">COMMAND   PID       USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</div><div class="line">mysqld  20150     sense   14u  IPv6 0x6bbd735884c780f7      0t0  TCP *:mysql (LISTEN)</div></pre></td></tr></table></figure>
<h2 id="根据进程id列出所有打开的文件-lsof-p-PID"><a href="#根据进程id列出所有打开的文件-lsof-p-PID" class="headerlink" title="根据进程id列出所有打开的文件 lsof -p PID"></a>根据进程id列出所有打开的文件 <code>lsof -p PID</code></h2><pre><code>&gt;lsof -p 20150 #mysql pid
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">COMMAND   PID       USER   FD   TYPE             DEVICE  SIZE/OFF     NODE NAME</div><div class="line">mysqld  20150       sense  cwd    DIR                1,2       374   978880 /usr/local/var/mysql</div><div class="line">mysqld  20150       sense  txt    REG                1,2  11827628 12007666 /usr/local/Cellar/mysql/5.6.17_1/bin/mysqld</div><div class="line">mysqld  20150       sense  txt    REG                1,2    358016 11997624 /usr/local/Cellar/openssl/1.0.1g/lib/libssl.1.0.0.dylib</div><div class="line">mysqld  20150       sense  txt    REG                1,2   1569360 11997621 /usr/local/Cellar/openssl/1.0.1g/lib/libcrypto.1.0.0.dylib</div><div class="line">mysqld  20150       sense  txt    REG                1,2    154576     2530 /System/Library/CoreServices/Encodings/libSimplifiedChineseConverter.dylib</div><div class="line">mysqld  20150       sense  txt    REG                1,2    600832  4153010 /usr/lib/dyld</div><div class="line">mysqld  20150       sense  txt    REG                1,2 343645146 12741449 /private/var/db/dyld/dyld_shared_cache_x86_64</div></pre></td></tr></table></figure>
<h2 id="列出某个用户的所有活动进程的pid-lsof-t-u-username"><a href="#列出某个用户的所有活动进程的pid-lsof-t-u-username" class="headerlink" title="列出某个用户的所有活动进程的pid lsof -t -u [username]"></a>列出某个用户的所有活动进程的pid <code>lsof -t -u [username]</code></h2><pre><code>&gt;lsof -t -u sense
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">58</div><div class="line">138</div><div class="line">141</div><div class="line">142</div><div class="line">145</div><div class="line">148</div><div class="line">154</div><div class="line">156</div><div class="line">160</div><div class="line">161</div><div class="line">162</div></pre></td></tr></table></figure>
<p>这个命令和<code>killall</code>组合就可以杀死某个用户所有的活动进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">killall -9 `lsof -t -u sense`</div></pre></td></tr></table></figure>
<h2 id="列出某个目录中被打开的文件-lsof-D-path-of-the-directory"><a href="#列出某个目录中被打开的文件-lsof-D-path-of-the-directory" class="headerlink" title="列出某个目录中被打开的文件 lsof +D [path_of_the_directory]"></a>列出某个目录中被打开的文件 <code>lsof +D [path_of_the_directory]</code></h2><pre><code>&gt;lsof +D ~/Developer
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">COMMAND     PID       USER   FD   TYPE DEVICE SIZE/OFF     NODE NAME</div><div class="line">zsh       19582       sense  cwd    DIR    1,2     3536 13227011 /Users/sense/Developer/github/blog/_posts</div><div class="line">Atom\x20H 19663       sense  txt    REG    1,2   153560 13226977 /Users/sense/Developer/github/blog/.git/objects/pack/pack-d3a1d10546c07101507e49f33bb3d45c8cf18030.idx</div><div class="line">Atom\x20H 19663       sense  txt    REG    1,2  5322160 13225111 /Users/sense/Developer/github/blog/.git/objects/pack/pack-d3a1d10546c07101507e49f33bb3d45c8cf18030.pack</div><div class="line">Atom\x20H 19663       sense   27r   REG    1,2  5322160 13225111 /Users/sense/Developer/github/blog/.git/objects/pack/pack-d3a1d10546c07101507e49f33bb3d45c8cf18030.pack</div><div class="line">Atom\x20H 19663       sense   31r   REG    1,2     3969 13391542 /Users/sense/Developer/github/blog/_posts/2014-05-01-about-lsof.md</div><div class="line">Atom\x20H 19663       sense   33r   DIR    1,2     3536 13227011 /Users/sense/Developer/github/blog/_posts</div><div class="line">Atom\x20H 19686       sense   33r   DIR    1,2     3536 13227011 /Users/sense/Developer/github/blog/_posts</div><div class="line">lsof      20387       sense  cwd    DIR    1,2     3536 13227011 /Users/sense/Developer/github/blog/_posts</div><div class="line">lsof      20388       sense  cwd    DIR    1,2     3536 13227011 /Users/sense/Developer/github/blog/_posts</div></pre></td></tr></table></figure>
<h2 id="根据进程名列出打开的文件-lsof-c-process-name"><a href="#根据进程名列出打开的文件-lsof-c-process-name" class="headerlink" title="根据进程名列出打开的文件 lsof -c [process_name]"></a>根据进程名列出打开的文件 <code>lsof -c [process_name]</code></h2><pre><code>&gt;lsof -c Atom
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">COMMAND     PID       USER   FD     TYPE             DEVICE   SIZE/OFF     NODE NAME</div><div class="line">Atom      19651       sense  cwd      DIR                1,2       1088        2 /</div><div class="line">Atom      19651       sense  txt      REG                1,2      18400 13308696 /Applications/Atom.app/Contents/MacOS/Atom</div><div class="line">Atom      19651       sense  txt      REG                1,2    5363624 13308549 /Applications/Atom.app/Contents/Frameworks/Atom Framework.framework/Versions/A/Atom Framework</div><div class="line">Atom      19651       sense  txt      REG                1,2     240916 13308692 /Applications/Atom.app/Contents/Frameworks/Squirrel.framework/Versions/A/Squirrel</div><div class="line">Atom      19651       sense  txt      REG                1,2    1125924 13308670 /Applications/Atom.app/Contents/Frameworks/ReactiveCocoa.framework/Versions/A/ReactiveCocoa</div><div class="line">Atom      19651       sense  txt      REG                1,2     204352 13308607 /Applications/Atom.app/Contents/Frameworks/Mantle.framework/Versions/A/Mantle</div><div class="line">Atom      19651       sense  txt      REG                1,2   75500632 13308552 /Applications/Atom.app/Contents/Frameworks/Atom Framework.framework/Versions/A/Libraries/libchromiumcontent.dylib</div></pre></td></tr></table></figure>
<h2 id="列出所有网络连接-lsof-i"><a href="#列出所有网络连接-lsof-i" class="headerlink" title="列出所有网络连接 lsof -i"></a>列出所有网络连接 <code>lsof -i</code></h2><pre><code>&gt;lsof -i
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">COMMAND     PID       USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</div><div class="line">UserEvent   141       sense    6u  IPv4 0x6bbd735883aeec5f      0t0  UDP *:*</div><div class="line">SystemUIS   171       sense    5u  IPv4 0x6bbd735883aee88f      0t0  UDP *:*</div><div class="line">sharingd    180       sense   18u  IPv4 0x6bbd7358876c57cf      0t0  UDP *:*</div><div class="line">mysqld    20150       sense   14u  IPv6 0x6bbd735884c780f7      0t0  TCP *:mysql (LISTEN)</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://i.joymvp.com/[object Object]/2014-05-01-sched-setaffinity.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lie的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]/2014-05-01-sched-setaffinity.html" itemprop="url">未命名</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T12:16:35+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]/2014-05-01-sched-setaffinity.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/[object Object]/2014-05-01-sched-setaffinity.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>layout: post<br>title: 如何指定进程运⾏行的CPU<br>categories:</p>
<pre><code>- 技术
</code></pre><p>tags:</p>
<pre><code>- cpu
- taskset
- sched_setaffinity
</code></pre><hr>
<p>原 荐 如何指定进程运⾏行的CPU<br>coolshell最新的⽂文章《性能调优攻略》在“多核CPU调优”章节,提到“我们不能任由操作系统负载均衡, 因为我们⾃自⼰己更了解⾃自⼰己的程序,所以,我们可以⼿手动地为其分配CPU核,⽽而不会过多地占⽤用CPU0, 或是让我们关键进程和⼀一堆别的进程挤在⼀一起。”。在⽂文章中提到了Linux下的⼀一个⼯工具,taskset,可以 设定单个进程运⾏行的CPU。<br>同时,因为最近在看redis的相关资料,redis作为单进程模型的程序,为了充分利⽤用多核CPU,常常在⼀一 台server上会启动多个实例。⽽而为了减少切换的开销,有必要为每个实例指定其所运⾏行的CPU。<br>下⽂文,将会介绍taskset命令,以及sched_setaffinity系统调⽤用,两者均可以指定进程运⾏行的CPU实例。 </p>
<h2 id="taskset"><a href="#taskset" class="headerlink" title="taskset"></a>taskset</h2><p>taskset是LINUX提供的⼀一个命令(ubuntu系统可能需要⾃自⾏行安装,schedutils package)。他可以让某个 程序运⾏行在某个(或)某些CPU上。<br>以下均以redis-server举例。 1)显⽰示进程运⾏行的CPU 命令taskset -p 21184 显⽰示结果:<br>pid 21184’s current affinity mask: ffffff 注:21184是redis-server运⾏行的pid<br>显⽰示结果的ffffff实际上是⼆二进制24个低位均为1的bitmask,每⼀一个1对应于1个CPU,表⽰示该进程在 24个CPU上运⾏行<br>2)指定进程运⾏行在某个特定的CPU上<br>命令taskset -pc 3 21184<br>显⽰示结果:</p>
<pre><code>pid 21184&apos;s current affinity list: 0-23 pid 21184&apos;s new affinity list: 3
</code></pre><p>注:3表⽰示CPU将只会运⾏行在第4个CPU上(从0开始计数)。 3)进程启动时指定CPU<br>命令taskset -c 1 ./redis-server ../redis.conf<br>结合这上边三个例⼦子,再看下taskset的manual,就⽐比较清楚了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">OPTIONS</div><div class="line">-p, --pid</div><div class="line">operate on an existing PID and not launch a new task</div><div class="line">-c, --cpu-list</div><div class="line">specify a numerical list of processors instead of a bitmask. The list may contain multiple items, separated by comma, and ranges. For example, 0,5,7,9-11.</div></pre></td></tr></table></figure>
<h2 id="sched-setaffinity系统调⽤用"><a href="#sched-setaffinity系统调⽤用" class="headerlink" title="sched_setaffinity系统调⽤用"></a>sched_setaffinity系统调⽤用</h2><p>如下⽂文章部分翻译⾃自:<a href="http://www.thinkingparallel.com/2006/08/18/more-information-on-pthread_setaffinity_np-and-sched_setaffinity/" target="_blank" rel="external">http://www.thinkingparallel.com/2006/08/18/more-information-on-pthread_setaffinity_np-and-sched_setaffinity/</a></p>
<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>sched_setaffinity可以将某个进程绑定到⼀一个特定的CPU。你⽐比操作系统更了解⾃自⼰己的程序,为了避免 调度器愚蠢的调度你的程序,或是为了在多线程程序中避免缓存失效造成的开销,你可能会希望这样 做。如下是sched_setaffinity的例⼦子,其函数⼿手册可以参考 (<a href="http://www.linuxmanpages.com/man2/sched_getaffinity.2.php" target="_blank" rel="external">http://www.linuxmanpages.com/man2/sched_getaffinity.2.php</a>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">double waste_time(long n) while(i &lt;n * 200000) &#123;</div><div class="line">res += sqrt (i);</div><div class="line">int main(int argc, char **argv)</div><div class="line">unsigned long mask = 1;</div><div class="line">if (sched_setaffinity(0, sizeof(mask), &amp;mask) &lt;0) &#123;</div><div class="line">perror(&quot;sched_setaffinity&quot;);</div><div class="line">printf (&quot;result: %f\n&quot;, waste_time (2000));</div><div class="line">if (sched_setaffinity(0, sizeof(mask), &amp;mask) &lt;0) &#123; perror(&quot;sched_setaffinity&quot;);</div><div class="line">printf (&quot;result: %f\n&quot;, waste_time (2000));</div></pre></td></tr></table></figure>
<p>根据你CPU的快慢,调整waste_time的参数。然后使⽤用top命令,就可以看到进程在不同CPU之间的切 换。(启动top命令后按“1”,可以看到各个CPU的情况)。<br>⽗父进程和⼦子进程之间会继承对affinity的设置。因此,⼤大胆猜测,taskset实际上是⾸首先执⾏行了<br>sched_setaffinity系统调⽤用,然后fork+exec⽤用户指定的进程。 假设业务模型中耗费cpu的分四种类型,(1)⽹网卡中断(2)1个处理⽹网络收发包进程(3)耗费cpu的n个worker<br>进程(4)其他不太耗费cpu的进程<br>基于1中的 负载均衡是针对进程数,那么(1)(2)⼤大部分时间会出现在cpu0上,(3)的n个进程会随着调度,<br>平均到其他多个cpu上,(4)⾥里的进程也是随着调度分配到各个cpu上; 当发⽣生⽹网卡中断的时候,cpu被打断了,处理⽹网卡中断,那么分配到cpu0上的worker进程肯定是运⾏行不<br>了的<br>其他cpu上不是太耗费cpu的进程获得cpu时,就算它的时间⽚片很短,它也是要执⾏行的,那么这个时候, 你的worker进程还是被影响到了;按照调度逻辑,⼀一种⾮非常恶劣的情况是:(1)(2)(3)的进程全部分配到 cpu0上,其他不太耗费cpu的进程数很多,全部分配到cpu1,cpu2,cpu3上。。那么⽹网卡中断发⽣生的时 候,你的业务进程就得不到cpu了<br>如果从业务的⾓角度来说,worker进程运⾏行越多,肯定业务处理越快,⼈人为的将它捆绑到其他负载低的 cpu上,肯定能提⾼高worker进程使⽤用cpu的时间<br>每个cpu都利⽤用起来了,负载会⽐比不绑定的情况下好很多<br>有效果的原因:<br>依据《linux内核设计与实现》的42节,⼈人为控制⼀一下cpu的绑定还是有⽤用处地 linux的SMP负载均衡是基于进程数的,每个cpu都有⼀一个可执⾏行进程队列(为什么不是线程队列<br>呢??),只有当其中⼀一个cpu的可执⾏行队列⾥里进程数⽐比其他cpu队列进程数多25%时,才会将进程移动 到另外空闲cpu上,也就是说cpu0上的进程数应该是⽐比其他cpu上多,但是会在25%以内。<br>⽰示例程序<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//cpu.c</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/sysinfo.h&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> num = sysconf(_SC_NPROCESSORS_CONF);</div><div class="line">    <span class="keyword">int</span> created_thread = <span class="number">0</span>;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"usage : ./cpu num\n"</span>);</div><div class="line">    myid = atoi(argv[<span class="number">1</span>]);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"system has %i processor(s). \n"</span>, num);</div><div class="line">    CPU_SET(myid, &amp;mask);</div><div class="line">    <span class="keyword">if</span> (sched_setaffinity(<span class="number">0</span>,<span class="keyword">sizeof</span>(mask), &amp;mask) == <span class="number">-1</span>)</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"warning: could not set CPU affinity, continuing...\n"</span>); CPU_ZERO(&amp;get);</div><div class="line">    <span class="keyword">if</span> (sched_getaffinity(<span class="number">0</span>, <span class="keyword">sizeof</span>(get), &amp;get) == <span class="number">-1</span>) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"warning: cound not get cpu affinity, continuing...\n"</span>);</div><div class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; num; i++) &#123; </div><div class="line">            <span class="keyword">if</span> (CPU_ISSET(i, &amp;get)) &#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"this process %d is running processor : %d\n"</span>,getpid(), i);</div></pre></td></tr></table></figure></p>
<p>下⾯面是在两个终端分别执⾏行了./cpu 0 ./cpu 2 后得到的结果. 效果⽐比较明显. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Cpu0 : 5.3%us, 5.3%sy, 0.0%ni, 87.4%id, 0.0%wa, 0.0%hi, 2.0%si, 0.0%st </div><div class="line">Cpu1 : 0.0%us, 0.0%sy, 0.0%ni,100.0%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st </div><div class="line">Cpu2 : 5.0%us, 12.2%sy, 0.0%ni, 82.8%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st </div><div class="line">Cpu3 : 0.0%us, 0.0%sy, 0.0%ni,100.0%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st </div><div class="line">Cpu4 : 0.0%us, 0.0%sy, 0.0%ni, 99.7%id, 0.3%wa, 0.0%hi, 0.0%si, 0.0%st </div><div class="line">Cpu5 : 0.0%us, 0.0%sy, 0.0%ni,100.0%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st </div><div class="line">Cpu6 : 0.0%us, 0.0%sy, 0.0%ni,100.0%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st </div><div class="line">Cpu7 : 0.0%us, 0.0%sy, 0.0%ni,100.0%id, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st</div></pre></td></tr></table></figure>
<p>linux下的进程可以通过sched_setaffinity系统调⽤用设置进程亲和⼒力,</p>
<p>限定进程只能在某些特定的CPU上 运⾏行。负载均衡必须考虑遵守这个限制(前⾯面也多次提到)。</p>
<p>###迁移线程</p>
<p>前⾯面说到,在普通进程的load_balance过程中,如果负载不均衡,当前CPU会试图从最繁忙的 run_queue中pull⼏几个进程到⾃自⼰己的run_queue来。 但是如果进程迁移失败呢?当失败达到⼀一定次数的时候,内核会试图让⽬目标CPU主动push⼏几个进程过 来,这个过程叫做active_load_balance。这⾥里的“⼀一定次数”也是跟调度域的层次有关的,越低层次, 则“⼀一定次数”的值越⼩小,越容易触发active_load_balance。 这⾥里需要先解释⼀一下,为什么load_balance的过程中迁移进程会失败呢?最繁忙run_queue中的进程, 如果符合以下限制,则不能迁移:</p>
<ol>
<li>、进程的CPU亲和⼒力限制了它不能在当前CPU上运⾏行; </li>
<li>2、进程正在⽬目标CPU上运⾏行(正在运⾏行的进程显然是不能直接迁移的); </li>
<li>(此外,如果进程在⽬目标CPU上前⼀一次运⾏行的时间距离当前时间很⼩小,那么该进程被cache的数据可能 还有很多未被淘汰,则称该进程的cache还是热的。对于cache热的进程,也尽量不要迁移它们。但是在 满⾜足触发active_load_balance的条件之前,还是会先试图迁移它们。) 对于CPU亲和⼒力有限制的进程(限制1),即使active_load_balance被触发,⽬目标CPU也不能把它push<br>过来。所以,实际上,触发active_load_balance的⽬目的是要尝试把当时正在⽬目标CPU上运⾏行的那个进程 弄过来(针对限制2)。<br>在每个CPU上都会运⾏行⼀一个迁移线程,active_load_balance要做的事情就是唤醒⽬目标CPU上的迁移线 程,让它执⾏行active_load_balance的回调函数。在这个回调函数中尝试把原先因为正在运⾏行⽽而未能迁移 的那个进程push过来。为什么load_balance的时候不能迁移,active_load_balance的回调函数中就可以 了呢?因为这个回调函数是运⾏行在⽬目标CPU的迁移线程上的。⼀一个CPU在同⼀一时刻只能运⾏行⼀一个进程, 既然这个迁移线程正在运⾏行,那么期望被迁移的那个进程肯定不是正在被执⾏行的,限制2被打破。<br>当然,在active_load_balance被触发,到回调函数在⽬目标CPU上被执⾏行之间,⽬目标CPU上的 TASK_RUNNING状态的进程可能发⽣生⼀一些变化,所以回调函数发起迁移的进程未必就只有之前因为限 制2⽽而未能被迁移的那⼀一个,可能更多,也可能⼀一个没有。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://i.joymvp.com/[object Object]/2014-05-18-routing-traffic-localhost.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lie的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]/2014-05-18-routing-traffic-localhost.html" itemprop="url">未命名</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T12:16:35+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]/2014-05-18-routing-traffic-localhost.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/[object Object]/2014-05-18-routing-traffic-localhost.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>layout: post<br>title: 127.0.0.1与localhost与ip的区别<br>categories:</p>
<pre><code>- 技术
</code></pre><p>tags:</p>
<pre><code>- localhost
- 127.0.0.1
</code></pre><hr>
<p>###localhost<br>不联网<br>不使用网卡，不受防火墙和网卡限制<br>本机访问 </p>
<p>一般使用 <code>本地套接字文件AF_UNIX</code> 应用程序一般约定使用<code>localhost</code>时优先查本地套接字连接. mysql_client 与  mysql_server 就是这样的约定</p>
<p>###127.0.0.1<br>不联网<br>网卡传输，受防火墙和网卡限制<br>本机访问  </p>
<p>127.0.0.1 是主机IP堆栈内部的IP地址..在<code>windows/unix</code> IP协议栈内部发现要发网的ip地址是<code>127.0.0.l</code>则立刻返回应用层..</p>
<p>###192.168.*.*<br>联网<br>网卡传输 ，受防火墙和网卡限制<br>本机或局域网访问</p>
<p>###本机IP<br>联网<br>网卡传输 ，受防火墙和网卡限制<br>本机或局域网或外部访问</p>
<p>###为什么localhost不使用网卡但hosts里却有记录</p>
<p>方便需要解析时,指向需要解析成ip的应用程序仍然会使用/etc/hosts 解析为127.0.0.1<br>比如ping</p>
<p>比如当浏览器中访问<code>http://localhost</code> 因为基于<code>tcp/ip</code>协议，就需要查<code>host</code>表</p>
<p>而我们使用<code>mysql</code>时指定默认使用的是<code>locaLhost</code>，这个使用了 <code>/tmp/mysql.sock</code> <code>本地套接字文件AF_UNIX</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://i.joymvp.com/[object Object]/2014-05-14-python-daemon.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lie的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]/2014-05-14-python-daemon.html" itemprop="url">未命名</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T12:16:35+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]/2014-05-14-python-daemon.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/[object Object]/2014-05-14-python-daemon.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>layout: post<br>title: 用python实现守护进程<br>categories:</p>
<pre><code>- 技术
</code></pre><p>tags:</p>
<pre><code>- 守护进程
- python
- daemon
</code></pre><hr>
<p>什么都懒得说，直接上代码<br>原文在：<a href="http://blog.csdn.net/dysj4099/article/details/18219411" target="_blank" rel="external">Linux守护进程设计规范及python实现</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div></pre></td><td class="code"><pre><div class="line">#! /usr/bin/env python</div><div class="line"></div><div class="line">import sys</div><div class="line">import os</div><div class="line">import time</div><div class="line">import atexit</div><div class="line"></div><div class="line">from signal import SIGTERM</div><div class="line"></div><div class="line"></div><div class="line">class Daemon(object):</div><div class="line"></div><div class="line">    &quot;&quot;&quot;</div><div class="line">    A generic daemon class.</div><div class="line"></div><div class="line">    Usage:subclass the Daemon class and override the run() method</div><div class="line">    &quot;&quot;&quot;</div><div class="line"></div><div class="line">    def __init__(self, pidfile, stdin=&apos;/dev/null&apos;, stdout=&apos;/dev/null&apos;, stderr=&apos;/dev/null&apos;):</div><div class="line">        self.stdin = stdin</div><div class="line">        self.stdout = stdout</div><div class="line">        self.stderr = stderr</div><div class="line">        self.pidfile = pidfile</div><div class="line"></div><div class="line">    def daemonize(self):</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        do the UNIX double-fork magic, see Stevens&apos;s &quot;Advanced</div><div class="line">        Programming in the UNIX Environment&quot; for detaill (ISBN 0201563177)</div><div class="line">        http://www.erlenstar.demon.co.uk/unix/faq_2.html#SEC16</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        try:</div><div class="line">            pid = os.fork()</div><div class="line">            if pid &gt; 0:</div><div class="line">                # exit first parent</div><div class="line">                sys.exit(0)</div><div class="line">        except OSError, e:</div><div class="line">            sys.stderr.write(</div><div class="line">                &quot;fork #1 failed:&#123;1&#125; (&#123;2&#125;) \n&quot;.format(e.errno, e.strerror))</div><div class="line">            sys.exit(1)</div><div class="line"></div><div class="line">        # decouble from parent enviroment</div><div class="line">        os.chdir(&quot;/&quot;)</div><div class="line">        os.setsid()</div><div class="line">        os.umask(0)</div><div class="line"></div><div class="line">        # do the second fork</div><div class="line">        try:</div><div class="line">            pid = os.fork()</div><div class="line">            if pid &gt; 0:</div><div class="line">                # exit from second parent</div><div class="line">                sys.exit(0)</div><div class="line">        except OSError, e:</div><div class="line">            sys.stderr.write(</div><div class="line">                &quot;fork #2 failed:&#123;0&#125; (1)\n&quot;.format(e.errno, e.strerror))</div><div class="line"></div><div class="line">        # redirect standard file descriptors</div><div class="line">        sys.stdout.flush()</div><div class="line">        sys.stderr.flush()</div><div class="line">        si = file(self.stdin, &apos;r&apos;)</div><div class="line">        so = file(self.stdout, &apos;a+&apos;)</div><div class="line">        se = file(self.stderr, &apos;a+&apos;, 0)</div><div class="line"></div><div class="line">        os.dup2(si.fileno(), sys.stdin.fileno())</div><div class="line">        os.dup2(so.fileno(), sys.stdout.fileno())</div><div class="line">        os.dup2(se.fileno(), sys.stderr.fileno())</div><div class="line"></div><div class="line">        # write pidfile</div><div class="line">        atexit.register(self.delpid)</div><div class="line">        pid = str(os.getpid())</div><div class="line">        file(self.pidfile, &apos;w+&apos;).write(&quot;&#123;0&#125;\n&quot;.format(pid))</div><div class="line"></div><div class="line">    def delpid(self):</div><div class="line">        os.remove(self.pidfile)</div><div class="line"></div><div class="line">    def start(self):</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        start the daemon</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        # Check for a pidfile to see if the daemon already runs</div><div class="line">        try:</div><div class="line">            pf = file(self.pidfile, &apos;r&apos;)</div><div class="line">            pid = int(pf.read().strip())</div><div class="line">            pf.close</div><div class="line">        except IOError:</div><div class="line">            pid = None</div><div class="line"></div><div class="line">        if pid:</div><div class="line">            message = &quot;pidfile &#123;0&#125; already exist. Daemon already running?\n&quot;</div><div class="line">            sys.stderr.write(message.format(self.pidfile))</div><div class="line">            sys.exit(1)</div><div class="line"></div><div class="line">        # start the daemon</div><div class="line">        self.daemonize()</div><div class="line">        self.run()</div><div class="line"></div><div class="line">    def stop(self):</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        Stop the daemon</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        # Get the pid from the pidfile</div><div class="line">        try:</div><div class="line">            pf = file(self.pidfile, &apos;r&apos;)</div><div class="line">            pid = int(pf.read().strip())</div><div class="line">            pf.close()</div><div class="line">        except IOError:</div><div class="line">            pid = None</div><div class="line"></div><div class="line">        if not pid:</div><div class="line">            message = &quot;pidfile &#123;0&#125; does not exist. Deamon not running?\n&quot;</div><div class="line">            sys.stderr.write(message.format(self.pidfile))</div><div class="line">            return</div><div class="line"></div><div class="line">        # try to kill the Daemon</div><div class="line">        try:</div><div class="line">            while 1:</div><div class="line">                os.kill(pid, SIGTERM)</div><div class="line">                time.sleep(0.1)</div><div class="line">        except OSError, err:</div><div class="line">            err = str(err)</div><div class="line">            if err.find(&quot;No such process&quot;) &gt; 0:</div><div class="line">                if (os.path.exists(self.pidfile)):</div><div class="line">                    os.remove(self.pidfile)</div><div class="line">            else:</div><div class="line">                print str(err)</div><div class="line">                sys.exit(1)</div><div class="line"></div><div class="line">    def restart(self):</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        Restart the daemon</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        self.stop()</div><div class="line">        self.start()</div><div class="line"></div><div class="line">    def run(self):</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        You should override the method when you subclass Daemon. It will</div><div class="line">        be called after the daemonized by start() or restart()</div><div class="line">        &quot;&quot;&quot;</div><div class="line"></div><div class="line"></div><div class="line">class DaemonDemo(Daemon):</div><div class="line"></div><div class="line">    def run(self):</div><div class="line">        while True:</div><div class="line">            sys.stdout.write(&quot;help me!\n&quot;)</div><div class="line">            sys.stdout.flush()</div><div class="line">            time.sleep(1)</div><div class="line"></div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    pid = &quot;/tmp/daemon-example.pid&quot;</div><div class="line">    stdout = &quot;/tmp/daemon-example.stdout&quot;</div><div class="line">    daemon = DaemonDemo(pidfile=pid, stdout=stdout)</div><div class="line">    if len(sys.argv) == 2:</div><div class="line">        if &apos;start&apos; == sys.argv[1]:</div><div class="line">            daemon.start()</div><div class="line">        elif &apos;stop&apos; == sys.argv[1]:</div><div class="line">            daemon.stop()</div><div class="line">        elif &apos;restart&apos; == sys.argv[1]:</div><div class="line">            daemon.restart()</div><div class="line">        else:</div><div class="line">            print &apos;Unknown command&apos;</div><div class="line">            sys.exit(2)</div><div class="line"></div><div class="line">        sys.exit(0)</div><div class="line">    else:</div><div class="line">        print &apos;usage:%s start|stop|restart &apos;.format(sys.argv[1])</div><div class="line">        sys.exit(2)</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://i.joymvp.com/[object Object]/2014-05-25-leveldb-c-example.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lie的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]/2014-05-25-leveldb-c-example.html" itemprop="url">未命名</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T12:16:35+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]/2014-05-25-leveldb-c-example.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/[object Object]/2014-05-25-leveldb-c-example.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>layout: post<br>title: leveldb c 栗子<br>categories:</p>
<pre><code>- 技术
</code></pre><p>tags:</p>
<pre><code>- leveldb
- c
</code></pre><hr>
<p>###前言</p>
<p>   之前写的栗子都是非c版，c版尝试一两次一直失败，这次不甘心，重新来过，终于能走通了</p>
<p>###环境</p>
<pre><code>系统：mac 10.9.3
</code></pre><p>###安装</p>
<pre><code>brew  install leveldb
brew  link leveldb  #这步最惨，如果失败请加 --force
</code></pre><p>###Makefile</p>
<pre><code>LDFLAGS = -lleveldb
CDFLAGS =-std=c99

lx: main.c
    gcc $(LDFLAGS) $(CDFLAGS)  -o lx main.c
run: lx
    ./lx
clean:
    rm -f *.o main *.gz *.tar
archive:
    tar -zcvf lx.tar.gz lx
</code></pre><h3 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h3><pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

#include &lt;leveldb/c.h&gt;

int main( void ) 
{
    leveldb_t               *db;
    leveldb_options_t       *options;
    leveldb_readoptions_t   *roptions;
    leveldb_writeoptions_t  *woptions;

    char *err = NULL;
    char *read;

    const char* dbfile  = &quot;testdb.ldb&quot;;
    const char* key     = &quot;name&quot;;
    const char* value   = &quot;luojianguo&quot;;

    size_t read_len;

    /* leveldb version */
    fprintf(stderr,&quot;version:%d.%d\n&quot;,leveldb_major_version(),leveldb_minor_version());


    /* open the database */
    options = leveldb_options_create();
    leveldb_options_set_create_if_missing(options,1);
    db = leveldb_open(options,dbfile,&amp;err);

    if ( err != NULL )
    {
        fprintf(stderr,&quot;Open testdb fail.\n&quot;);
        return ( EXIT_FAILURE );
    }

    /* reset error var */
    leveldb_free( err );
    err = NULL;

    /* WRITE */
    woptions = leveldb_writeoptions_create();
    leveldb_put(db,woptions,key,strlen(key),value,strlen(value), &amp;err);
    if ( err != NULL )
    {
        fprintf(stderr,&quot;Write fail.\n&quot;);
        return ( EXIT_FAILURE );
    }

    leveldb_free(err);
    err = NULL;


    /* READ */
    roptions = leveldb_readoptions_create();
    read = leveldb_get(db,roptions, key, strlen(key), &amp;read_len, &amp;err);
    if ( err != NULL )
    {
        fprintf(stderr, &quot;Read fail.\n&quot;);
        return ( EXIT_FAILURE );
    }
    printf(&quot;%s:%s\n&quot;,key,read);

    leveldb_free( read );
    read = NULL;

    leveldb_free ( err );
    err = NULL;

    /*************************************************/
    /** delete **/
    leveldb_delete(db,woptions, key, strlen(key),&amp;err );
    if ( err != NULL )
    {
        fprintf(stderr,&quot;Delete fail.\n&quot;);
        return ( EXIT_FAILURE );
    }

    /************************************************/
    /* close db */

    leveldb_close( db );

    /***********************************************/
    /* destroy */
    leveldb_destroy_db( options, dbfile, &amp;err );
    if ( err != NULL )
    {
        fprintf(stderr, &quot;Destory fail.\n&quot;);
        return ( EXIT_FAILURE );
    }

    leveldb_free( err );
    err = NULL;

    return EXIT_SUCCESS;
}
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://i.joymvp.com/[object Object]/2014-05-31-about-girl-friends-1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lie的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]/2014-05-31-about-girl-friends-1.html" itemprop="url">未命名</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T12:16:35+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]/2014-05-31-about-girl-friends-1.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/[object Object]/2014-05-31-about-girl-friends-1.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>layout: post<br>title: Yomix的那些绯闻：玉儿<br>categories:</p>
<pre><code>- 生活
</code></pre><p>tags:</p>
<pre><code>- 绯闻
</code></pre><hr>
<p>2013年7月23日：＋Q<br>2014年5月22日：第一次聊天<br>2014年5月28日：第一次通电话  </p>
<p>第一次见面会在什么时候呢？</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://i.joymvp.com/[object Object]/2014-06-01-my-password-v1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lie的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]/2014-06-01-my-password-v1.html" itemprop="url">未命名</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T12:16:35+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]/2014-06-01-my-password-v1.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/[object Object]/2014-06-01-my-password-v1.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>layout: post<br>title: 我的密码算法v1.0<br>categories:</p>
<pre><code>- 技术
</code></pre><p>tags:</p>
<pre><code>- 密码
- 密码保护 
</code></pre><hr>
<p>起因是 csdn密码泄露事件。那天晚上我彻夜未眠…把所有网站密码改了一通，不管是用了没用那个密码的都改…</p>
<p>然后就发现了一个噩梦…如果每个网站的密码都不一样，那记起来岂不是噩梦。于是把几个主要的网站密码改的不一样，其他网站都一样…另外把用到的安全邮箱都指向了很早之前注册的但经常不用的另外一个邮箱..</p>
<p>这个密码v1.0版本是2012年8月份形成的，之前主要用在蘑菇街/美丽说/返还网等密码中.说起来好简单..</p>
<p>ps:目前密码进化到v3版…万变不离其宗，变化的主要目的是不让那么随便猜出basepassword</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var md5passwd = md5(&apos;[basepassword]&apos;);   </div><div class="line">var salt = md5password[1..n] #n = [1,3,5,7,9,13,17,19,23,29,31]   </div><div class="line">var passwd = md5(salt+ &apos;[email]&apos; +&apos;[domain]&apos;)[0..8]</div></pre></td></tr></table></figure>
<p>example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">    &quot;crypto/md5&quot;</div><div class="line">    &quot;fmt&quot;</div><div class="line">    &quot;io&quot;</div><div class="line">)</div><div class="line"></div><div class="line">func main() &#123;</div><div class="line"></div><div class="line">    var salt []byte</div><div class="line"></div><div class="line">    domain := &quot;www.mogujie.com&quot;</div><div class="line">    email := &quot;123@mogujie.com&quot;</div><div class="line">    basepasswd := &quot;123456&quot;</div><div class="line"></div><div class="line">    prim := []uint32&#123;1, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31&#125;</div><div class="line"></div><div class="line">    h := md5.New()</div><div class="line">    io.WriteString(h, basepasswd)</div><div class="line">    md5basepasswd := fmt.Sprintf(&quot;%x&quot;, h.Sum(nil))</div><div class="line">    for _, v := range prim &#123;</div><div class="line">        salt = append(salt, md5basepasswd[v])</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    hh := md5.New()</div><div class="line">    io.WriteString(h, string(salt))</div><div class="line">    io.WriteString(h, email)</div><div class="line">    io.WriteString(h, domain)</div><div class="line">    md5str := fmt.Sprintf(&quot;%x&quot;, hh.Sum(nil))</div><div class="line">    fmt.Println(md5str[0:9])</div><div class="line">    // output:d41d8cd98</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为什么使用md5因为md5出来的值刚好32位，第32位在程序语言中是31..是一个质数<br>也就是说md5出来的值最有一位参与了后面的计算过程</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://i.joymvp.com/[object Object]/2014-09-17-zhihu-edm.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lie的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]/2014-09-17-zhihu-edm.html" itemprop="url">知乎EDM邮件随想</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T12:16:35+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/运营/" itemprop="url" rel="index">
                    <span itemprop="name">运营</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]/2014-09-17-zhihu-edm.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/[object Object]/2014-09-17-zhihu-edm.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>就在几个月前，我面试了一个产品经理，一个比较初级的产品经理，他简历上唯一让我感兴趣的就是edm优化经验. 那个时候问过他好多问题，其中有一个问题讨论了好久：<strong>怎么衡量edm的效果</strong>？ 答曰：<strong>给每一个可以点击的地方加上统计代码</strong>.</p>
<p>今天，打开email，发现 <a href="http://www.zhihu.com" target="_blank" rel="external">知乎</a> 发了一封非常煽情的邮件给我,原文如下：</p>
<p><img src="/assets/image/zhihuedm.jpg" alt="知乎edm"></p>
<p>从运营角度看:</p>
<ol>
<li><p>这篇文字足够煽情，让我不想点都不行。  </p>
</li>
<li><p>这是绝笔信，虽然也称得上是退订信，但方法是不一样的，退订信的意思是如果你看不惯的话可以选择退订。 绝笔信的意思是如果你不立马点击，俺们以后绝交….试想，谁会无情呢？</p>
</li>
<li><p>全文唯一可以点击的地方是：继续写信给我…. 这个按钮带来的是什么呢？如果点击了这个按钮代表的是：一可能是：我已经有阅读你的来信，只是我懒得点击你给我的内容而已. 二：你之前的内容还是不错，我还是有可能等的。 为什么呢？因为如果点击了这个按钮，就代表知乎的周刊还是能正常发送到邮箱的。不然收不到这封信 </p>
</li>
<li><p>这封邮件的时间宽限是15天. 从某些方面说代表了这个人打开邮箱的频率…</p>
</li>
<li><p>按钮背后的点击逻辑其实就是统计：<code>http://tmail.zhihu.com/t?u=...hwbG9yZSNtb250a...1dG1fbWVkaXVtPWVtYWls&amp;i=205298632&amp;l=zhihu&amp;s=1&amp;c=aT0yMDUyOTg2MzImbD16aGlodS...</code> </p>
</li>
<li><p>点击后最终跳转的地址是： <a href="http://www.zhihu.com/explore#monthly-hot?utm_campaign=winback_201409&amp;utm_source=email&amp;utm_medium=email" target="_blank" rel="external">http://www.zhihu.com/explore#monthly-hot?utm_campaign=winback_201409&amp;utm_source=email&amp;utm_medium=email</a></p>
</li>
<li><p>最重要的一点：邮件标题叫做：xxx 我可能要离开你了 </p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://i.joymvp.com/[object Object]/2014-06-05-about-idempotency-1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lie的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/[object Object]/2014-06-05-about-idempotency-1.html" itemprop="url">一切为了你  `幂等`</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T12:16:35+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/[object Object]/2014-06-05-about-idempotency-1.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="/[object Object]/2014-06-05-about-idempotency-1.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开启<code>full stack</code>工程师这么久，从来没这么认真考虑过前后端相通的那些故事</p>
<p>读 <code>http协议</code>,每次看到<code>post</code>是非<code>幂等</code>,<code>get</code> <code>delete</code> <code>put</code> 都是 <code>幂等</code>的时候，就想起了后端的流程，很多，都是需要<code>幂等</code></p>
<p>前些日子接手做充值系统,</p>
<p>初始流程是：</p>
<pre><code>选择金额 -&gt; 选择银行 -&gt; 充值成功 -&gt; 返回充值成功页面-&gt;插入数据库
                             |
                             |- 银行后台回掉-&gt;插入数据库
</code></pre><p>这时候如果不设置 <code>交易流水号</code> 为唯一主键，就会发生2次充值成功的情况</p>
<p>发现不对劲后，我们设置<code>交易号</code> 为 <code>唯一主键</code>, 于是解决了那个问题..然后真的以为解决了…</p>
<p>过了几天，我们运营说我们要统计充值成功率… 一顿修改，流程变成了</p>
<pre><code>选择金额 -&gt; 选择银行 -&gt;跳转中间页入库--&gt; 充值成功 -&gt; 返回充值成功页面-&gt;更新数据
                                            |
                                            |- 银行后台回掉-&gt;更新数据
</code></pre><p>然后悲剧又发生了，因为更新充值记录这个操作附带了很多其他操作,在update的时候因为要更新<code>payed_time</code> 所以每次回掉都会更新，于是，变成了一次充值成功，多次积分记录操作</p>
<p>无奈之下，只能把更新操作变成2步：一步是更新状态，第二步是更新金额和时间. 只有在第一步成功基础上才能执行第二步操作和后续的操作，好吧，之后，流程总算稳定了下来..</p>
<p>过几天又来了一次小插曲，说充值显示成功了，但积分没有记录，于是只好写一个定时计划任务（为啥不用任务队列）定时的检查数据…又是一个幂等的案例…</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="lie" />
          <p class="site-author-name" itemprop="name">lie</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">120</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">41</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lie</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://timer.disqus.com/count.js" async></script>
    

    

  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
